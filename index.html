<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
<style>
	.player_number{
		font-weight: bold;
		vertical-align:middle;
	}
	.card {
		width:100px;
		height=200px;
	}
</style>
<title>Page Title</title>
</head>
<body>

<h1>Repartidor de Pocha</h1>

<div>
	<form id="game_parameters">
		<label for="game_id">¿Identificador de la partida?</label><br>
		<input type="text" id="game_id" name="game_id" value="Pochón de la muerte"><br>
		<label for="number_of_players">¿Cuántos Jugadores?</label><br>
		<input type="number" id="number_of_players" name="number_of_players" min="1" value="4"><br>
		<label for="player_number">¿Qué jugador eres?</label><br>
		<input type="number" id="player_number" name="player_number" min="1" max="player_number" value="1"><br>
		<label for="number_of_cards">¿Cuantas Cartas?</label><br>
		<input type="number" id="number_of_cards" name="round" min="1" max="40/player_number" value="1"><br>
		<input type="button" onclick="shuffleCards()" value="Reparte cartas">
	</form>
</div>
<div id="board">
</div>



	<script>
		!function(f,a,c){var s,l=256,p="random",d=c.pow(l,6),g=c.pow(2,52),y=2*g,h=l-1;function n(n,t,r){function e(){for(var n=u.g(6),t=d,r=0;n<g;)n=(n+r)*l,t*=l,r=u.g(1);for(;y<=n;)n/=2,t/=2,r>>>=1;return(n+r)/t}var o=[],i=j(function n(t,r){var e,o=[],i=typeof t;if(r&&"object"==i)for(e in t)try{o.push(n(t[e],r-1))}catch(n){}return o.length?o:"string"==i?t:t+"\0"}((t=1==t?{entropy:!0}:t||{}).entropy?[n,S(a)]:null==n?function(){try{var n;return s&&(n=s.randomBytes)?n=n(l):(n=new Uint8Array(l),(f.crypto||f.msCrypto).getRandomValues(n)),S(n)}catch(n){var t=f.navigator,r=t&&t.plugins;return[+new Date,f,r,f.screen,S(a)]}}():n,3),o),u=new m(o);return e.int32=function(){return 0|u.g(4)},e.quick=function(){return u.g(4)/4294967296},e.double=e,j(S(u.S),a),(t.pass||r||function(n,t,r,e){return e&&(e.S&&v(e,u),n.state=function(){return v(u,{})}),r?(c[p]=n,t):n})(e,i,"global"in t?t.global:this==c,t.state)}function m(n){var t,r=n.length,u=this,e=0,o=u.i=u.j=0,i=u.S=[];for(r||(n=[r++]);e<l;)i[e]=e++;for(e=0;e<l;e++)i[e]=i[o=h&o+n[e%r]+(t=i[e])],i[o]=t;(u.g=function(n){for(var t,r=0,e=u.i,o=u.j,i=u.S;n--;)t=i[e=h&e+1],r=r*l+i[h&(i[e]=i[o=h&o+t])+(i[o]=t)];return u.i=e,u.j=o,r})(l)}function v(n,t){return t.i=n.i,t.j=n.j,t.S=n.S.slice(),t}function j(n,t){for(var r,e=n+"",o=0;o<e.length;)t[h&o]=h&(r^=19*t[h&o])+e.charCodeAt(o++);return S(t)}function S(n){return String.fromCharCode.apply(0,n)}if(j(c.random(),a),"object"==typeof module&&module.exports){module.exports=n;try{s=require("crypto")}catch(n){}}else"function"==typeof define&&define.amd?define(function(){return n}):c["seed"+p]=n}("undefined"!=typeof self?self:this,[],Math);
	</script>
	<script>
		let number_of_players = 4;
		let round = 6;
		let player = 3;

	function shuffleCards()
	{
		// Clean previous round
		clearBoard();

		let game_params = document.getElementById("game_parameters");

		let seed = game_params.elements[0].value;
		Math.seedrandom( seed );
		let number_of_players = game_params.elements[1].value;
		let number_of_cards_per_hand =  game_params.elements[3].value;
		let player = game_params.elements[2].value - 1;
		let deck = createDeck();
		let hands = distributeCards( deck,
					     number_of_cards_per_hand,
					     number_of_players );
		displayHands( hands, player );
	}

	function createDeck()
	{
		let card_number = 0;
		let card_suit = 0;
		let deck = [];
		for ( let i = 1; i <= 40; i++ )
		{
			deck.push([ card_suit, card_number ]);
			if ( i % 10 == 0 )
			{
				card_number = 0;
				card_suit++;
			}
			else
			{
				card_number++;
				if ( card_number == 7 )
				{
					// Skip 8 and 9
					card_number = 9;
				}
			}
		}
		return deck;
	}

	function distributeCards( deck,
				  number_of_cards_per_hand,
				  number_of_players )
	{
		let hands = [];
		let random_card = 0;
		for ( let player = 0; player < number_of_players; player++ )
		{
			let hand = [];
			for ( let card_number = 0; card_number < number_of_cards_per_hand; card_number++ )
			{
				random_card = Math.floor(Math.random()*deck.length);
				hand[ card_number ] = deck[ random_card ];
				deck.splice(random_card, 1);
			}
			hands.push( hand );
		}
		return hands;
	}

	function clearBoard()
	{
		let board = document.getElementById("board");
		board.innerHTML = '';
	}

	function displayHands( hands, player )
	{
		if ( hands[ player ].length == 1 )
		{
			for ( let player_hand = 0; player_hand < hands.length; player_hand++ )
			{
				if ( player_hand != player )
				{
					displayHand( player_hand,
						     hands[ player_hand ] );
				}
			}
		}
		else
		{
			displayHand( player,
				     hands[ player ] );
		}
	}

	function displayHand( player, hand )
	{
		let suit_names = ["oros", "copas", "espadas", "bastos"];
		let board = document.getElementById("board");
		let player_number = document.createElement("span");
		player_number.setAttribute("class", "player_number");
		player_number.innerHTML = "Jugador " + (player + 1);
		board.appendChild( player_number );
		for ( let i = 0; i < hand.length; i++ )
		{
			let card_image = document.createElement("img");
			card_image.setAttribute("class","card");
			card_image.src = "http://www.consultacartas.com/imagenes/baraja_espanola/" + suit_names[ hand[i][0] ] + "_" + (hand[i][1]+1) + ".jpg";
			card_image.old_src = "https://i.pinimg.com/originals/10/80/a4/1080a4bd1a33cec92019fab5efb3995d.png";
			card_image.onclick = hideCard;
			board.appendChild( card_image );
		}
		let new_line = document.createElement("br");
		board.appendChild( new_line );
	}

	function hideCard()
	{
		console.log("Pinchada una carta")
		let temp_img = this.old_src;
		this.old_src = this.src;
		this.src = temp_img;
	}

	</script>
</body>
</html> 
